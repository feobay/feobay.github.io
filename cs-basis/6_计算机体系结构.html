<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>计算机体系结构 | FeoBay的个人博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="https://feobay.oss-cn-shanghai.aliyuncs.com/img/terminal.svg">
    <meta name="description" content="Just for fun">
    
    <link rel="preload" href="/assets/css/0.styles.6d920bc0.css" as="style"><link rel="preload" href="/assets/js/app.72c8bf2a.js" as="script"><link rel="preload" href="/assets/js/2.2702b4bf.js" as="script"><link rel="preload" href="/assets/js/17.1a82dfdf.js" as="script"><link rel="prefetch" href="/assets/js/10.a94df392.js"><link rel="prefetch" href="/assets/js/11.632e5645.js"><link rel="prefetch" href="/assets/js/12.55b415ad.js"><link rel="prefetch" href="/assets/js/13.b6a9667b.js"><link rel="prefetch" href="/assets/js/14.9fa2841e.js"><link rel="prefetch" href="/assets/js/15.db6a460d.js"><link rel="prefetch" href="/assets/js/16.051721e3.js"><link rel="prefetch" href="/assets/js/18.b3fd6f3e.js"><link rel="prefetch" href="/assets/js/19.013ce65f.js"><link rel="prefetch" href="/assets/js/20.c1c40422.js"><link rel="prefetch" href="/assets/js/21.a2cce3e9.js"><link rel="prefetch" href="/assets/js/3.3c9c7e39.js"><link rel="prefetch" href="/assets/js/4.d25869ab.js"><link rel="prefetch" href="/assets/js/5.1840f9a3.js"><link rel="prefetch" href="/assets/js/6.03bfa775.js"><link rel="prefetch" href="/assets/js/7.368f46d5.js"><link rel="prefetch" href="/assets/js/8.e438b600.js"><link rel="prefetch" href="/assets/js/9.39ebbd5e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6d920bc0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://feobay.oss-cn-shanghai.aliyuncs.com/img/terminal.svg" alt="FeoBay的个人博客" class="logo"> <span class="site-name can-hide">FeoBay的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/cs-basis/" class="nav-link router-link-active">
  计算机基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法刷题
</a></div><div class="nav-item"><a href="/notes/" class="nav-link">
  随记
</a></div><div class="nav-item"><a href="https://github.com/feobay" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/cs-basis/" class="nav-link router-link-active">
  计算机基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法刷题
</a></div><div class="nav-item"><a href="/notes/" class="nav-link">
  随记
</a></div><div class="nav-item"><a href="https://github.com/feobay" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/cs-basis/" aria-current="page" class="sidebar-link">计算机基础</a></li><li><a href="/cs-basis/1_C++.html" class="sidebar-link">C++</a></li><li><a href="/cs-basis/2_EffectiveC++.html" class="sidebar-link">EffectiveC++</a></li><li><a href="/cs-basis/3_STL源码剖析.html" class="sidebar-link">STL源码剖析（侯捷）</a></li><li><a href="/cs-basis/4_ComputerNetwork.html" class="sidebar-link">计算机网络</a></li><li><a href="/cs-basis/5_操作系统.html" class="sidebar-link">操作系统</a></li><li><a href="/cs-basis/6_计算机体系结构.html" class="active sidebar-link">计算机体系结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs-basis/6_计算机体系结构.html#存储器层次结构" class="sidebar-link">存储器层次结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs-basis/6_计算机体系结构.html#整体概览" class="sidebar-link">整体概览</a></li><li class="sidebar-sub-header"><a href="/cs-basis/6_计算机体系结构.html#存储技术" class="sidebar-link">存储技术</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="计算机体系结构"><a href="#计算机体系结构" class="header-anchor">#</a> 计算机体系结构</h1> <h2 id="存储器层次结构"><a href="#存储器层次结构" class="header-anchor">#</a> 存储器层次结构</h2> <p>本章关键词：<strong>存储技术</strong>、<strong>局部性</strong>、<strong>存储器层次结构</strong>、<strong>高速缓存存储器</strong>、<strong>编写高速缓存友好的代码</strong>、<strong>存储器山</strong></p> <h3 id="整体概览"><a href="#整体概览" class="header-anchor">#</a> 整体概览</h3> <p><strong>存储器系统（memory system)</strong> 是一个具有 许多不同容量、成本和访问时间的存储设备 的 层次结构。</p> <p>从 快到慢 、小到大 、贵到便宜 内到外分别是：</p> <ul><li><strong>CPU寄存器</strong>：保存着最常用的数据。</li> <li><strong>高速缓存存储器(L1~L3 Cache)</strong>: CPU与主存之间，存放 相对慢速的主存储器中的一部分数据和指令。</li> <li><strong>主存储器(main memory)</strong>: 存储来自更慢更大的磁盘上已经持久化的数据。</li> <li><strong>外存(磁盘、固态硬盘...)</strong>: 存放持久化数据，通常也作为 通过网络连接的主机之间 进行数据传输的 缓冲区域。</li></ul> <p><strong>存储器层次结构整体</strong>（CSAPP中文3版-P421）</p> <p><img src="https://feobay.oss-cn-shanghai.aliyuncs.com/img/image-20221017170802527.png" alt="image-20221017170802527"></p> <p><strong>Intel Core i7 的高速缓存结构</strong> （CSAPP中文3版-P438）</p> <p><img src="https://feobay.oss-cn-shanghai.aliyuncs.com/img/image-20221017170943865.png" alt="image-20221017170943865"></p> <p>Regs: register 寄存器</p> <p>d-cache: data cache，只保存数据</p> <p>i-cache: introduction cache，只保存指令</p> <p>这个层次结构的一个有趣的特性是所有的 SRAM高速缓存存储器都 在 CPU 芯 片上。</p> <h3 id="存储技术"><a href="#存储技术" class="header-anchor">#</a> 存储技术</h3> <p>目前的存储技术主要有：<strong>SRAM</strong>存储器、<strong>DRAM</strong>存储器、<strong>ROM</strong>存储器以及<strong>旋转</strong>和<strong>固态</strong>的硬盘</p> <p>**随机访问存储器(Random Access Memory, RAM)**有两类</p> <ul><li><p>静态的(Static RAM, <strong>SRAM</strong>)</p> <blockquote><p>每个位存储于一个 <strong>双稳态(bistable)<strong>存储器单元里。其通过一个</strong>六晶体管</strong>电路来实现。</p> <p>该电路可以无限期保持在两个不同的电压配置或者状态。</p> <p>也就是说，<strong>只要有电，它就会永远地保持它的值。</strong></p></blockquote></li> <li><p>动态的(Dynamic RAM, <strong>DRAM</strong>)</p> <blockquote><p>DRAM的每个位通过对一个电容充电来区分01</p> <p>其<strong>每个单元由一个电容和一个晶体管组成</strong>，所以可以很密集</p> <p>但DRAM单元容易<strong>漏电</strong>，通常会在10~100毫秒内失去电荷</p> <p>幸运的是计算机运行时钟周期通常是以纳秒来计算，所以<strong>内存系统需要周期性地通过读出、重写来刷新每一位</strong>。</p></blockquote> <p>CSAPP中文3版-P401</p></li></ul> <p><img src="https://feobay.oss-cn-shanghai.aliyuncs.com/img/image-20221017214542189.png" alt="image-20221017214542189"></p> <p><strong>传统DRAM</strong></p> <p>DRAM 芯 片 中的单元 （位） 被分成 d个超单元 (supercell)， 每个超单元都由 w个 DRAM 单元组成 。 一个d X w的 DRAM 总共存储 了 dw 位信息。</p> <p>超单元被组织成一个r行c列的长 方形阵列 ， 这里rc=d 。 每个超单元有形如（i，j）的地址， 这里i表示行， 而 j 表示列。</p> <p>e.g. 如下图：</p> <p>16个超单元，每个超单元存储8位</p> <p><img src="https://feobay.oss-cn-shanghai.aliyuncs.com/img/image-20221017222231304.png" alt="image-20221017222231304"></p> <p>取数据步骤</p> <ol><li>根据addr，将指定地一整行数据复制到内部行缓冲区</li> <li>再根据addr指定地列号，将行缓冲中对应的超单元中的w位数据复制并发送到内存控制器</li></ol> <blockquote><p>为何发送两次？</p> <p>DRAM被组织成二维阵列而不是线性数组，<strong>降低</strong>了芯片上<strong>地址引脚的数量</strong>。<strong>缺点</strong>就是必须<strong>分两步发送地址，这增加了访问时间</strong>。</p></blockquote> <p><strong>内存模块</strong></p> <p>DRAM作为计算机的主存。</p> <p>多个DRAM芯片一起封装在**内存模块（memory module）**中，它插到主板的扩展槽上。</p> <p>每一个64位数据分为8份（每份1字节8bit）存储在不同DRAM芯片的相同位置。下图展示了内存模块的基本思想：</p> <p><img src="https://feobay.oss-cn-shanghai.aliyuncs.com/img/image-20221017230139501.png" alt="image-20221017230139501"></p> <blockquote><p>64位处理器，一次处理64位数据，这64位数据分8个字节存储在8个不同DRAM芯片的相同位置</p></blockquote> <p><strong>增强的DRAM</strong></p> <ul><li><p>双倍数据速率同步DRAM（Double Data-Rate Synchronous DRAM，DDR SDRAM）</p> <p>使用两个时钟沿作为控制信号，从而让DRAM的速度翻倍</p> <p>不同类型的DDR SDRAM是用提高 <strong>预取缓冲区</strong> 有效带宽大小来划分的：</p> <p>DDR(2位)，DDR2(4位)，DDR3(8位)，DDR4(16位)</p></li></ul> <p><strong>非易失性存储器</strong></p> <p>DRAM和SRAM在断电后都会丢失信息，所以它们都是<strong>易失的</strong>(volatile)</p> <p><strong>非易失性存储器</strong>就是即使断电，仍然可以保留信息。由于历史原因，这类存储器整体多是 <strong>只读存储器（Read-Only Memory，ROM）</strong>，所以一般也称为ROM。</p> <p>分类如下：</p> <ul><li><p><strong>PROM</strong>( Programmable ROM , 可编程 ROM) <strong>只能被编程一次</strong></p> <blockquote><p>PROM 的每个存储器单元有一种熔丝( fuse) ， 只能用高电流熔断一次。</p></blockquote></li> <li><p><strong>可擦写可编程ROM</strong> (Erasable Programmable ROM , <strong>EPROM</strong>)，<strong>可编程 1000 次</strong></p> <blockquote><p>有一个透明的石英窗口，允许光到达存储单元 。紫外线光照射过窗 口，EPROM 单元就被清除为0。对 EPROM 编程是通过使用一种把 1 写入EPROM 的特殊设备来完成的。</p></blockquote></li> <li><p><strong>电子可擦除PROM</strong>(Electrically Erasable  PROM , <strong>EEPROM</strong>)，可编程 $10 ^ 5$ 次</p> <blockquote><p>它不需要一个物理上独立的编程设备， 因此可以直接在印制电路卡上编程。</p></blockquote></li> <li><p><strong>闪存(flash memory)</strong>，<strong>基于EEPROM</strong></p> <blockquote><p>闪存是非易失性存储器，是一种<strong>重要的存储技术</strong>，为大量的电子设备提供快速而持久的非易失性存储，固态硬盘(SSD)就是基于闪存的。</p></blockquote></li></ul> <p>存储在 ROM 设备中的程序通常被称为 <strong>固件( firmware)</strong> 。</p> <blockquote><p>当一个计算机系统通电以后， 它会运行存储 在 ROM 中的固件。 一 些 系统在 固件中提供了少 鼠基本的输 入 和输出函 数一例如 PC 的 BIOS（基本输入／输出系统）例程。复杂的设备，像图形卡和磁盘驱动控制器，也依赖固件翻译来自 CPU 的I/O（输入／输出） 请求 。</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cs-basis/5_操作系统.html" class="prev">
        操作系统
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.72c8bf2a.js" defer></script><script src="/assets/js/2.2702b4bf.js" defer></script><script src="/assets/js/17.1a82dfdf.js" defer></script>
  </body>
</html>
